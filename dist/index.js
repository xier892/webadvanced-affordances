"use strict";var getRandomInt=function(e,t){return Math.floor(Math.random()*(Math.floor(t)-Math.ceil(e)))+Math.ceil(e)},getSizeOfElement=function(e,t){var a,n=document.createElement("div");switch(n.className=e,n.style.visibility="hidden",n.style.position="absolute",document.body.appendChild(n),t){case"width":a=n.getBoundingClientRect().width;break;case"height":a=n.getBoundingClientRect().height;break;default:a=n.getBoundingClientRect().width}return n.remove(),a},getWidthOfElement=function(e){return getSizeOfElement(e,"width")},getHeightOfElement=function(e){return getSizeOfElement(e,"height")},storageAvailable=function(e){var t;try{t=window[e];var a="__storage_test__";return t.setItem(a,a),t.removeItem(a),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&t&&0!==t.length}},populateStorage=function(e,t){storageAvailable("localStorage")&&localStorage.setItem(e,t)},retrieveStorage=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return storageAvailable("localStorage")?localStorage.getItem(e):t},removeStorage=function(e){storageAvailable("localStorage")&&localStorage.removeItem(e)},setMaximumCapacity=function(){return Math.ceil(window.innerWidth/getWidthOfElement("pill transformedWidthTest")*((window.innerHeight-getHeightOfElement("cap"))/getWidthOfElement("pill transformedWidthTest")))},setViewportHeight=function(){var e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px"))};setViewportHeight();var SETTINGS={PRESCRIPTION_DOSE_MIN:1,PRESCRIPTION_DOSE_MAX:5,PRESCRIPTION_QTY_MIN:1,PRESCRIPTION_QTY_MAX:setMaximumCapacity()};window.addEventListener("contextmenu",function(e){e.preventDefault()}),window.addEventListener("resize",function(){setViewportHeight(),SETTINGS.PRESCRIPTION_QTY_MAX=setMaximumCapacity()});var prescription={};SETTINGS.DEFAULT_PRESCRIPTION=JSON.stringify({quantity:Math.min(15,SETTINGS.PRESCRIPTION_QTY_MAX),dose:1}),retrieveStorage("prescription")||populateStorage("prescription",SETTINGS.DEFAULT_PRESCRIPTION);var updatePrescription=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.quantity,n=e.dose,l=t.skipValidation,i=SETTINGS.DEFAULT_PRESCRIPTION,o=SETTINGS.PRESCRIPTION_DOSE_MIN,r=SETTINGS.PRESCRIPTION_DOSE_MAX,c=SETTINGS.PRESCRIPTION_QTY_MIN,u=SETTINGS.PRESCRIPTION_QTY_MAX,d=JSON.parse(i);l?(prescription.dose=n,prescription.quantity=a):(prescription.dose=n<o?o:n>u?u:n>=o&&n<=r?Math.max(Math.round(n),o):d.dose,prescription.quantity=a<c?c:a>u?u:a>=c&&a<=u?Math.max(prescription.dose,Math.round(a)):d.quantity),populateStorage("prescription",JSON.stringify(prescription))};updatePrescription(JSON.parse(retrieveStorage("prescription",SETTINGS.DEFAULT_PRESCRIPTION)),{skipValidation:!0});var bottle={el:document.getElementById("bottle"),state:{capacity:"full"},setOpenState:function(e){bottle.state.capacity="fromStorage"===e?retrieveStorage("pillCount")>0?"full":"empty":pillCollection.count()>0?"full":"empty"},prepare:function(){switch(bottle.setOpenState(),bottle.state.capacity){case"empty":capunder.toggleButton("empty"),label.toggleInput("enable"),setTimeout(function(){label.toggle("show")},150);break;case"full":capunder.toggleButton("full");break;default:capunder.toggleButton("full")}},init:function(){bottle.setOpenState("fromStorage")}};bottle.init();var cap={properties:{width:0,height:0},state:{timer:0,clientX:0,clientY:0,deltaX:0,deltaY:0},setOpenState:function(e){cap.state.open="open"===e,populateStorage("capState",e)},depress:function(){cap.state.action="depressed",cap.el.className="cap pressed"},move:function(){cap.state.action="dragging",cap.el.className="cap dragging"},reset:function(){delete cap.state.action,cap.el.classList.remove("pressed","dragging"),cap.el.removeAttribute("style")},remove:function(){cap.state.action="dragged",cap.el.className="cap dragged",cap.setOpenState("open")},replace:function(){delete cap.state.action,cap.el.classList.remove("dragged"),cap.setOpenState("closed")},close:function(){setTimeout(cap.replace,50*retrieveStorage("pillCount",prescription.quantity)+250)},addEvents:function(){var e=cap.el,t=cap.properties,a=cap.state,n=cap.depress,l=cap.move,i=cap.reset,o=cap.remove,r=(cap.replace,t.width),c=t.height,u=a.timer,d=a.clientX,p=a.clientY,s=a.deltaX,m=a.deltaY;r=e.offsetWidth,c=e.offsetHeight,window.addEventListener("resize",function(){r=e.offsetWidth,c=e.offsetHeight}),e.addEventListener("touchstart",function(e){var t=e.touches;e.preventDefault(),d=t[0].clientX,p=t[0].clientY,u=setTimeout(n,250)},!1),e.addEventListener("touchmove",function(e){var t=e.target,n=e.touches;if(u&&clearTimeout(u),"depressed"===a.action||"dragging"===a.action){l(),s=n[0].clientX-d,m=n[0].clientY-p;var i=Math.max(-m/r,s/r);t.style.setProperty("--cap-rotate","".concat(i>0?Math.max(0,80*i):0,"deg")),t.style.setProperty("--cap-translate","".concat(m<0?Math.max(-40,m/4):0,"%"))}},!1),e.addEventListener("touchend",function(e){u&&clearTimeout(u),("dragging"===a.action&&s>=r/2.5||-m>=c/2.5)&&o(),i(),s=0,m=0},!1),e.addEventListener("touchcancel",function(e){u&&clearTimeout(u),i()},!1)},data:function(){var e=document.createElement("div");e.className="cap";for(var t=document.createDocumentFragment(),a=0;a<=12;a++){var n=document.createElement("div");n.className="cap-indent",t.appendChild(n)}return e.appendChild(t),e},init:function(){switch(cap.el=cap.data(),retrieveStorage("capState")){case"open":cap.remove();break;case"closed":break;default:cap.remove()}document.getElementById("top").appendChild(cap.el),cap.addEvents()}};cap.init();var capunder={toggleButton:function(){switch(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"full"){case"empty":buttonTake.toggle();break;case"full":buttonRefill.toggle();break;default:buttonRefill.toggle()}},data:function(){var e=document.createElement("section");return e.className="capunder",e},init:function(){capunder.el=capunder.data(),document.getElementById("top").appendChild(capunder.el)}};capunder.init();var buttonClose={addEvents:function(){buttonClose.el.addEventListener("touchend",function(e){cap.replace()},!1)},data:function(){var e=document.createElement("button");e.className="capunder-close",e.type="button",e.name="close";var t=document.createElement("img");return t.src="dist/assets/image/open-collapse-down.svg",t.alt="close",e.appendChild(t),e},init:function(){buttonClose.el=buttonClose.data(),buttonClose.addEvents(),capunder.el.appendChild(buttonClose.el)}};buttonClose.init();var buttonRefill={toggle:function(){var e=buttonRefill.el;document.body.contains(e)&&(e.remove(),buttonTake.init("toggle"))},addEvents:function(){buttonRefill.el.addEventListener("touchend",pillCollection.refill,!1)},removeEvents:function(){buttonRefill.el.removeEventListener("touchend",pillCollection.refill,!1)},data:function(){var e=document.createElement("button");e.className="capunder-refill",e.type="button",e.name="refill";var t=document.createDocumentFragment(),a=document.createElement("img");return a.src="dist/assets/image/material-arrow-drop-down.svg",a.alt="down arrow",t.appendChild(document.createTextNode("refill")),t.appendChild(document.createTextNode(" ")),t.appendChild(a),e.appendChild(t),e},init:function(){buttonRefill.el=buttonRefill.data(),buttonRefill.addEvents(),capunder.el.appendChild(buttonRefill.el)}},buttonTake={toggle:function(){var e=buttonTake.el;e.disabled=!0,setTimeout(function(){document.body.contains(e)?(e.remove(),buttonRefill.init()):e.removeAttribute("disabled")},300)},addEvents:function(){var e=buttonTake.el;e.removeAttribute("disabled"),e.addEventListener("touchend",function(e){pillCollection.take(prescription.dose)},!1)},data:function(){var e=document.createElement("button");e.className="capunder-take",e.type="button",e.name="take";var t=document.createDocumentFragment(),a=document.createElement("img");return a.src="dist/assets/image/material-arrow-drop-up.svg",a.alt="up arrow",t.appendChild(document.createTextNode("take")),t.appendChild(document.createTextNode(" ")),t.appendChild(a),e.appendChild(t),e},init:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";buttonTake.el=buttonTake.data(),"toggle"===e?(buttonTake.el.disabled=!0,setTimeout(buttonTake.addEvents,50*retrieveStorage("pillCount",prescription.quantity)+500)):buttonTake.addEvents(),capunder.el.appendChild(buttonTake.el)}};buttonTake.init();var label={el:document.getElementById("label"),toggle:function(e){label.el.parentNode.scrollTo({top:0,left:"show"===e?label.el.parentNode.offsetWidth:0,behavior:"smooth"})},toggleInput:function(e){labelDose.toggle(e),labelQuantity.toggle(e)},exportInformation:function(){updatePrescription({quantity:labelQuantity.value()?labelQuantity.value():labelQuantity.placeholderValue(),dose:labelDose.value()}),label.toggle(),labelQuantity.input(prescription.quantity),labelDose.select(prescription.dose),labelDate.setDate(),label.toggleInput("disable")}},labelDate={el:document.getElementById("label-date-number"),getDate:function(){var e=new Date;return{month:e.getMonth(),day:e.getDate(),year:e.getFullYear()}},setDate:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:labelDate.getDate(),t=labelDate.el;for(populateStorage("date",JSON.stringify(e));t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode("".concat(e.month+1,"-").concat("0".concat(e.day).slice(-2),"-").concat(e.year)))},init:function(){retrieveStorage("date")&&labelDate.setDate(JSON.parse(retrieveStorage("date")))}};labelDate.init();var labelDose={el:document.getElementById("label-dose"),value:function(){var e=labelDose.el;return e.options[e.selectedIndex].text},select:function(e){labelDose.el.selectedIndex=e-1},toggle:function(e){switch(e){case"enable":labelDose.el.removeAttribute("disabled");break;case"disable":labelDose.el.disabled=!0;break;default:labelDose.el.removeAttribute("disabled")}},init:function(){for(var e=labelDose.el,t=labelDose.select,a=labelDose.toggle,n=document.createDocumentFragment(),l=SETTINGS.PRESCRIPTION_DOSE_MIN;l<=SETTINGS.PRESCRIPTION_DOSE_MAX;l++){var i=document.createElement("option");i.appendChild(document.createTextNode(l)),i.value=l,n.appendChild(i)}e.appendChild(n),t(prescription.dose),a("disable")}};labelDose.init();var labelQuantity={el:document.getElementById("label-quantity"),elMax:document.getElementById("label-quantity-max"),elMaxNumber:document.getElementById("label-quantity-max-number"),value:function(){return labelQuantity.el.value},placeholderValue:function(){return labelQuantity.el.placeholder},input:function(e){labelQuantity.el.value=e},inputPlaceholder:function(e){labelQuantity.el.placeholder=e,e||labelQuantity.el.removeAttribute("placeholder")},inputMax:function(e){for(var t=labelQuantity.elMaxNumber;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))},toggle:function(e){var t=labelQuantity.el;labelQuantity.elMax,labelQuantity.elMaxNumber,labelQuantity.inputMax;switch(e){case"enable":t.removeAttribute("disabled");break;case"disable":t.disabled=!0;break;default:t.removeAttribute("disabled")}},addEvents:function(){var e=labelQuantity.el,t=labelQuantity.elMax,a=labelQuantity.value,n=labelQuantity.placeholderValue,l=labelQuantity.input,i=labelQuantity.inputPlaceholder,o=labelQuantity.inputMax;e.addEventListener("focus",function(){i(a()),l(""),o(SETTINGS.PRESCRIPTION_QTY_MAX),t.style.opacity="1"}),e.addEventListener("blur",function(){a()?i():l(n()),t.removeAttribute("style"),o(SETTINGS.PRESCRIPTION_QTY_MAX)})},init:function(){var e=labelQuantity.el,t=labelQuantity.input,a=(labelQuantity.inputMax,labelQuantity.toggle),n=labelQuantity.addEvents;e.setAttribute("min",SETTINGS.PRESCRIPTION_QTY_MIN),e.setAttribute("max",SETTINGS.PRESCRIPTION_QTY_MAX),t(prescription.quantity),a("disable"),n()}};labelQuantity.init();var pill={append:function(){pillCollection.el.appendChild(this.el)},withdraw:function(){this.el.style.transform="translateY(100vh) rotate3d(1, 0, ".concat(getRandomInt(0,.5),", 90deg)")},drop:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=function(){e.el.classList.add("easeOutBounce"),setTimeout(function(){e.el.classList.remove("easeOutBounce")},500),e.append()};t>0?setTimeout(a,t):a()},data:function(){var e=document.createElement("div");return e.className="pill",e.style.setProperty("--pill-rotation","".concat(getRandomInt(0,360),"deg")),e},init:function(){this.el=this.data()}},Pill=function(){return Object.create(pill)},pillCollection={el:document.getElementById("pill-collection"),properties:{contents:[]},count:function(){return pillCollection.properties.contents.length},take:function(e){pillCollection.el;var t=pillCollection.properties.contents,a=Math.min(t.length,e);cap.state.open||cap.remove();for(var n=1;n<=a;n++)t[t.length-n].withdraw();t.splice(t.length-a,a),populateStorage("pillCount",Math.max(0,retrieveStorage("pillCount")-a)),bottle.prepare()},fill:function(e){pillCollection.el;for(var t=pillCollection.properties.contents,a=Object.prototype.hasOwnProperty.call(e,"quantity")?e.quantity:e,n=!!Object.prototype.hasOwnProperty.call(e,"drop")&&e.drop,l=0;l<a;l++){var i=new Pill;t.push(i),i.init(),n?i.drop(50*l):i.append()}populateStorage("pillCount",t.length),bottle.prepare()},refill:function(){buttonRefill.removeEvents();for(var e=pillCollection.el,t=pillCollection.fill;e.firstChild;)e.removeChild(e.firstChild);label.exportInformation(),t({quantity:prescription.quantity,drop:!0}),cap.close()},init:function(){retrieveStorage("pillCount")||populateStorage("pillCount",0),pillCollection.fill(retrieveStorage("pillCount"))}};pillCollection.init();