"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var getRandomInt=function(e,t){return Math.floor(Math.random()*(Math.floor(t)-Math.ceil(e)))+Math.ceil(e)},getSizeOfElement=function(e,t){var l,o=document.createElement("div");switch(o.className=e,o.style.visibility="hidden",o.style.position="absolute",document.body.appendChild(o),t){case"width":l=o.getBoundingClientRect().width;break;case"height":l=o.getBoundingClientRect().height;break;default:l=o.getBoundingClientRect().width}return o.remove(),l},getWidthOfElement=function(e){return getSizeOfElement(e,"width")},getHeightOfElement=function(e){return getSizeOfElement(e,"height")};!function(){function e(){var e=window,t=document;if(!("scrollBehavior"in t.documentElement.style&&!0!==e.__forceSmoothScrollPolyfill__)){var l,o=e.HTMLElement||e.Element,n=468,a={scroll:e.scroll||e.scrollTo,scrollBy:e.scrollBy,elementScroll:o.prototype.scroll||c,scrollIntoView:o.prototype.scrollIntoView},i=e.performance&&e.performance.now?e.performance.now.bind(e.performance):Date.now,r=(l=e.navigator.userAgent,new RegExp(["MSIE ","Trident/","Edge/"].join("|")).test(l)?1:0);e.scroll=e.scrollTo=function(){void 0!==arguments[0]&&(!0!==s(arguments[0])?f.call(e,t.body,void 0!==arguments[0].left?~~arguments[0].left:e.scrollX||e.pageXOffset,void 0!==arguments[0].top?~~arguments[0].top:e.scrollY||e.pageYOffset):a.scroll.call(e,void 0!==arguments[0].left?arguments[0].left:"object"!=_typeof(arguments[0])?arguments[0]:e.scrollX||e.pageXOffset,void 0!==arguments[0].top?arguments[0].top:void 0!==arguments[1]?arguments[1]:e.scrollY||e.pageYOffset))},e.scrollBy=function(){void 0!==arguments[0]&&(s(arguments[0])?a.scrollBy.call(e,void 0!==arguments[0].left?arguments[0].left:"object"!=_typeof(arguments[0])?arguments[0]:0,void 0!==arguments[0].top?arguments[0].top:void 0!==arguments[1]?arguments[1]:0):f.call(e,t.body,~~arguments[0].left+(e.scrollX||e.pageXOffset),~~arguments[0].top+(e.scrollY||e.pageYOffset)))},o.prototype.scroll=o.prototype.scrollTo=function(){if(void 0!==arguments[0])if(!0!==s(arguments[0])){var e=arguments[0].left,t=arguments[0].top;f.call(this,this,void 0===e?this.scrollLeft:~~e,void 0===t?this.scrollTop:~~t)}else{if("number"==typeof arguments[0]&&void 0===arguments[1])throw new SyntaxError("Value could not be converted");a.elementScroll.call(this,void 0!==arguments[0].left?~~arguments[0].left:"object"!=_typeof(arguments[0])?~~arguments[0]:this.scrollLeft,void 0!==arguments[0].top?~~arguments[0].top:void 0!==arguments[1]?~~arguments[1]:this.scrollTop)}},o.prototype.scrollBy=function(){void 0!==arguments[0]&&(!0!==s(arguments[0])?this.scroll({left:~~arguments[0].left+this.scrollLeft,top:~~arguments[0].top+this.scrollTop,behavior:arguments[0].behavior}):a.elementScroll.call(this,void 0!==arguments[0].left?~~arguments[0].left+this.scrollLeft:~~arguments[0]+this.scrollLeft,void 0!==arguments[0].top?~~arguments[0].top+this.scrollTop:~~arguments[1]+this.scrollTop))},o.prototype.scrollIntoView=function(){if(!0!==s(arguments[0])){var l=function(e){for(;e!==t.body&&!1===(o=d(l=e,"Y")&&u(l,"Y"),n=d(l,"X")&&u(l,"X"),o||n);)e=e.parentNode||e.host;var l,o,n;return e}(this),o=l.getBoundingClientRect(),n=this.getBoundingClientRect();l!==t.body?(f.call(this,l,l.scrollLeft+n.left-o.left,l.scrollTop+n.top-o.top),"fixed"!==e.getComputedStyle(l).position&&e.scrollBy({left:o.left,top:o.top,behavior:"smooth"})):e.scrollBy({left:n.left,top:n.top,behavior:"smooth"})}else a.scrollIntoView.call(this,void 0===arguments[0]||arguments[0])}}function c(e,t){this.scrollLeft=e,this.scrollTop=t}function s(e){if(null===e||"object"!=_typeof(e)||void 0===e.behavior||"auto"===e.behavior||"instant"===e.behavior)return!0;if("object"==_typeof(e)&&"smooth"===e.behavior)return!1;throw new TypeError("behavior member of ScrollOptions "+e.behavior+" is not a valid value for enumeration ScrollBehavior.")}function d(e,t){return"Y"===t?e.clientHeight+r<e.scrollHeight:"X"===t?e.clientWidth+r<e.scrollWidth:void 0}function u(t,l){var o=e.getComputedStyle(t,null)["overflow"+l];return"auto"===o||"scroll"===o}function p(t){var l,o,a,r,c=(i()-t.startTime)/n;r=c=c>1?1:c,l=.5*(1-Math.cos(Math.PI*r)),o=t.startX+(t.x-t.startX)*l,a=t.startY+(t.y-t.startY)*l,t.method.call(t.scrollable,o,a),o===t.x&&a===t.y||e.requestAnimationFrame(p.bind(e,t))}function f(l,o,n){var r,s,d,u,f=i();l===t.body?(r=e,s=e.scrollX||e.pageXOffset,d=e.scrollY||e.pageYOffset,u=a.scroll):(r=l,s=l.scrollLeft,d=l.scrollTop,u=c),p({scrollable:r,method:u,startTime:f,startX:s,startY:d,x:o,y:n})}}"object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports={polyfill:e}:e()}();var storageAvailable=function(e){var t;try{t=window[e];var l="__storage_test__";return t.setItem(l,l),t.removeItem(l),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&t&&0!==t.length}},populateStorage=function(e,t){storageAvailable("localStorage")&&localStorage.setItem(e,t)},retrieveStorage=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return storageAvailable("localStorage")?localStorage.getItem(e):t},removeStorage=function(e){storageAvailable("localStorage")&&localStorage.removeItem(e)},setMaximumCapacity=function(){return Math.ceil(window.screen.availWidth/getWidthOfElement("pill transformedWidthTest")*(.8*document.body.offsetHeight/getWidthOfElement("pill transformedWidthTest")))},SETTINGS={PRESCRIPTION_DOSE_MIN:1,PRESCRIPTION_DOSE_MAX:5,PRESCRIPTION_QTY_MIN:1,PRESCRIPTION_QTY_MAX:setMaximumCapacity()};window.addEventListener("contextmenu",function(e){e.preventDefault()}),window.addEventListener("resize",function(){SETTINGS.PRESCRIPTION_QTY_MAX=setMaximumCapacity()}),window.addEventListener("orientationchange",function(){SETTINGS.PRESCRIPTION_QTY_MAX=setMaximumCapacity()});var prescription={};SETTINGS.DEFAULT_PRESCRIPTION=JSON.stringify({quantity:Math.min(15,SETTINGS.PRESCRIPTION_QTY_MAX),dose:1}),retrieveStorage("prescription")||populateStorage("prescription",SETTINGS.DEFAULT_PRESCRIPTION);var updatePrescription=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=e.quantity,o=e.dose,n=t.skipValidation,a=SETTINGS.DEFAULT_PRESCRIPTION,i=SETTINGS.PRESCRIPTION_DOSE_MIN,r=SETTINGS.PRESCRIPTION_DOSE_MAX,c=SETTINGS.PRESCRIPTION_QTY_MIN,s=SETTINGS.PRESCRIPTION_QTY_MAX,d=JSON.parse(a);n?(prescription.dose=o,prescription.quantity=l):(prescription.dose=o<i?i:o>s?s:o>=i&&o<=r?Math.max(Math.round(o),i):d.dose,prescription.quantity=l<c?c:l>s?s:l>=c&&l<=s?Math.max(prescription.dose,Math.round(l)):d.quantity),populateStorage("prescription",JSON.stringify(prescription))};updatePrescription(JSON.parse(retrieveStorage("prescription",SETTINGS.DEFAULT_PRESCRIPTION)),{skipValidation:!0});var bottle={el:document.getElementById("bottle"),state:{capacity:"full"},setOpenState:function(e){bottle.state.capacity="fromStorage"===e?retrieveStorage("pillCount")>0?"full":"empty":pillCollection.count()>0?"full":"empty"},prepare:function(){switch(bottle.setOpenState(),bottle.state.capacity){case"empty":capunder.toggleButton("empty"),label.toggleInput("enable"),setTimeout(function(){label.toggle("show")},150);break;case"full":capunder.toggleButton("full");break;default:capunder.toggleButton("full")}},init:function(){bottle.setOpenState("fromStorage")}};bottle.init();var cap={properties:{width:0,height:0},state:{timer:0,clientX:0,clientY:0,deltaX:0,deltaY:0},setOpenState:function(e){cap.state.open="open"===e,populateStorage("capState",e)},depress:function(){cap.state.action="depressed",cap.el.classList.add("pressed")},move:function(){cap.state.action="dragging",cap.el.classList.add("dragging")},reset:function(){delete cap.state.action,cap.el.classList.remove("pressed","dragging"),cap.el.removeAttribute("style")},remove:function(){cap.state.action="dragged",cap.el.classList.add("dragged"),cap.setOpenState("open")},replace:function(){delete cap.state.action,cap.el.classList.remove("dragged"),cap.setOpenState("closed")},close:function(){setTimeout(cap.replace,50*retrieveStorage("pillCount",prescription.quantity)+250)},addEvents:function(){var e=cap.el,t=cap.properties,l=cap.state,o=cap.depress,n=cap.move,a=cap.reset,i=cap.remove,r=(cap.replace,t.width),c=t.height,s=l.timer,d=l.clientX,u=l.clientY,p=l.deltaX,f=l.deltaY;r=e.offsetWidth,c=e.offsetHeight,window.addEventListener("resize",function(){r=e.offsetWidth,c=e.offsetHeight}),window.addEventListener("orientationchange",function(){r=e.offsetWidth,c=e.offsetHeight}),e.addEventListener("touchstart",function(e){var t=e.touches;e.preventDefault(),d=t[0].clientX,u=t[0].clientY,s=setTimeout(o,250)},!1),e.addEventListener("touchmove",function(e){var t=e.target,o=e.touches;if(s&&clearTimeout(s),"depressed"===l.action||"dragging"===l.action){n(),p=o[0].clientX-d,f=o[0].clientY-u;var a=Math.max(-f/r,p/r);t.style.setProperty("--cap-rotate","".concat(a>0?Math.max(0,80*a):0,"deg")),t.style.setProperty("--cap-translate","".concat(f<0?Math.max(-40,f/4):0,"%"))}},!1),e.addEventListener("touchend",function(e){s&&clearTimeout(s),("dragging"===l.action&&p>=r/2.5||-f>=c/2.5)&&i(),a(),p=0,f=0},!1),e.addEventListener("touchcancel",function(e){s&&clearTimeout(s),a()},!1)},data:function(){var e=document.createElement("div");e.className="cap";for(var t=document.createDocumentFragment(),l=0;l<=12;l++){var o=document.createElement("div");o.className="cap-indent",t.appendChild(o)}return e.appendChild(t),e},init:function(){switch(cap.el=cap.data(),retrieveStorage("capState")){case"open":cap.remove();break;case"closed":break;default:cap.remove()}document.getElementById("top").appendChild(cap.el),cap.addEvents()}};cap.init();var capunder={toggleButton:function(){switch(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"full"){case"empty":buttonTake.toggle();break;case"full":buttonRefill.toggle();break;default:buttonRefill.toggle()}},data:function(){var e=document.createElement("section");return e.className="capunder",e},init:function(){capunder.el=capunder.data(),document.getElementById("top").appendChild(capunder.el)}};capunder.init();var buttonClose={addEvents:function(){buttonClose.el.addEventListener("touchend",function(e){cap.replace()},!1)},data:function(){var e=document.createElement("button");e.className="capunder-close",e.type="button",e.name="close";var t=document.createElement("img");return t.src="dist/assets/image/open-collapse-down.svg",t.alt="close",e.appendChild(t),e},init:function(){buttonClose.el=buttonClose.data(),buttonClose.addEvents(),capunder.el.appendChild(buttonClose.el)}};buttonClose.init();var buttonRefill={toggle:function(){var e=buttonRefill.el;document.body.contains(e)&&(e.remove(),buttonTake.init("toggle"))},addEvents:function(){buttonRefill.el.addEventListener("touchend",pillCollection.refill,!1)},removeEvents:function(){buttonRefill.el.removeEventListener("touchend",pillCollection.refill,!1)},data:function(){var e=document.createElement("button");e.className="capunder-refill",e.type="button",e.name="refill";var t=document.createDocumentFragment(),l=document.createElement("img");return l.src="dist/assets/image/material-arrow-drop-down.svg",l.alt="down arrow",t.appendChild(document.createTextNode("refill")),t.appendChild(document.createTextNode(" ")),t.appendChild(l),e.appendChild(t),e},init:function(){buttonRefill.el=buttonRefill.data(),buttonRefill.addEvents(),capunder.el.appendChild(buttonRefill.el)}},buttonTake={toggle:function(){var e=buttonTake.el;e.disabled=!0,setTimeout(function(){document.body.contains(e)?(e.remove(),buttonRefill.init()):e.removeAttribute("disabled")},300)},addEvents:function(){var e=buttonTake.el;e.removeAttribute("disabled"),e.addEventListener("touchend",function(e){pillCollection.take(prescription.dose)},!1)},data:function(){var e=document.createElement("button");e.className="capunder-take",e.type="button",e.name="take";var t=document.createDocumentFragment(),l=document.createElement("img");return l.src="dist/assets/image/material-arrow-drop-up.svg",l.alt="up arrow",t.appendChild(document.createTextNode("take")),t.appendChild(document.createTextNode(" ")),t.appendChild(l),e.appendChild(t),e},init:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";buttonTake.el=buttonTake.data(),"toggle"===e?(buttonTake.el.disabled=!0,setTimeout(buttonTake.addEvents,50*retrieveStorage("pillCount",prescription.quantity)+500)):buttonTake.addEvents(),capunder.el.appendChild(buttonTake.el)}};buttonTake.init();var label={el:document.getElementById("label"),toggle:function(e){label.el.parentNode.scrollTo({top:0,left:"show"===e?label.el.parentNode.offsetWidth:0,behavior:"smooth"})},toggleInput:function(e){labelDose.toggle(e),labelQuantity.toggle(e)},exportInformation:function(){updatePrescription({quantity:labelQuantity.value()&&RegExp("^[0-9]*$").test(labelQuantity.value())?labelQuantity.value():labelQuantity.placeholderValue(),dose:labelDose.value()}),label.toggle(),labelQuantity.input(prescription.quantity),labelQuantity.inputPlaceholder(),labelDose.select(prescription.dose),labelDate.setDate(),label.toggleInput("disable")}},labelDate={el:document.getElementById("label-date-number"),getDate:function(){var e=new Date;return{month:e.getMonth(),day:e.getDate(),year:e.getFullYear()}},setDate:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:labelDate.getDate(),t=labelDate.el;for(populateStorage("date",JSON.stringify(e));t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode("".concat(e.month+1,"-").concat("0".concat(e.day).slice(-2),"-").concat(e.year)))},init:function(){retrieveStorage("date")&&labelDate.setDate(JSON.parse(retrieveStorage("date")))}};labelDate.init();var labelDose={el:document.getElementById("label-dose"),value:function(){var e=labelDose.el;return e.options[e.selectedIndex].text},select:function(e){labelDose.el.selectedIndex=e-1},toggle:function(e){switch(e){case"enable":labelDose.el.removeAttribute("disabled");break;case"disable":labelDose.el.disabled=!0;break;default:labelDose.el.removeAttribute("disabled")}},init:function(){for(var e=labelDose.el,t=labelDose.select,l=labelDose.toggle,o=document.createDocumentFragment(),n=SETTINGS.PRESCRIPTION_DOSE_MIN;n<=SETTINGS.PRESCRIPTION_DOSE_MAX;n++){var a=document.createElement("option");a.appendChild(document.createTextNode(n)),a.value=n,o.appendChild(a)}e.appendChild(o),t(prescription.dose),l("disable")}};labelDose.init();var labelQuantity={el:document.getElementById("label-quantity"),elMax:document.getElementById("label-quantity-max"),elMaxNumber:document.getElementById("label-quantity-max-number"),value:function(){return labelQuantity.el.value},placeholderValue:function(){return labelQuantity.el.placeholder},input:function(e){labelQuantity.el.value=e},inputPlaceholder:function(e){labelQuantity.el.placeholder=e,e||labelQuantity.el.removeAttribute("placeholder")},inputMax:function(e){for(var t=labelQuantity.elMaxNumber;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))},toggle:function(e){var t=labelQuantity.el;labelQuantity.elMax,labelQuantity.elMaxNumber,labelQuantity.inputMax;switch(e){case"enable":t.removeAttribute("disabled");break;case"disable":t.disabled=!0;break;default:t.removeAttribute("disabled")}},addEvents:function(){var e=labelQuantity.el,t=labelQuantity.elMax,l=labelQuantity.value,o=labelQuantity.placeholderValue,n=labelQuantity.input,a=labelQuantity.inputPlaceholder,i=labelQuantity.inputMax;e.addEventListener("focus",function(){l()&&RegExp("^[0-9]*$").test(l())&&a(l()),n(""),i(SETTINGS.PRESCRIPTION_QTY_MAX),t.classList.add("visible")}),e.addEventListener("blur",function(){if(l()&&RegExp(/^\d*\.?\d*$/).test(l()))if(!RegExp("^[0-9]*$").test(l())||l()<SETTINGS.PRESCRIPTION_QTY_MIN||l()>SETTINGS.PRESCRIPTION_QTY_MAX){var e=Math.round(l());e<SETTINGS.PRESCRIPTION_QTY_MIN?(n(SETTINGS.PRESCRIPTION_QTY_MIN),a(SETTINGS.PRESCRIPTION_QTY_MIN)):e>SETTINGS.PRESCRIPTION_QTY_MAX?(n(SETTINGS.PRESCRIPTION_QTY_MAX),a(SETTINGS.PRESCRIPTION_QTY_MAX)):(n(e),a(e))}else a(l());else n(o());t.classList.remove("visible"),i(SETTINGS.PRESCRIPTION_QTY_MAX)})},init:function(){var e=labelQuantity.el,t=labelQuantity.input,l=(labelQuantity.inputMax,labelQuantity.toggle),o=labelQuantity.addEvents;e.setAttribute("min",SETTINGS.PRESCRIPTION_QTY_MIN),e.setAttribute("max",SETTINGS.PRESCRIPTION_QTY_MAX),t(prescription.quantity),l("disable"),o()}};labelQuantity.init();var pill={append:function(){pillCollection.el.appendChild(this.el)},withdraw:function(){this.el.classList.add("withdrawn"),this.el.style.setProperty("--z-rotation",getRandomInt(0,.5))},drop:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,l=function(){e.el.classList.add("easeOutBounce"),setTimeout(function(){e.el.classList.remove("easeOutBounce")},500),e.append()};t>0?setTimeout(l,t):l()},data:function(){var e=document.createElement("div");return e.className="pill",e.style.setProperty("--pill-rotation","".concat(getRandomInt(0,360),"deg")),e},init:function(){this.el=this.data()}},Pill=function(){return Object.create(pill)},pillCollection={el:document.getElementById("pill-collection"),properties:{contents:[]},count:function(){return pillCollection.properties.contents.length},take:function(e){pillCollection.el;var t=pillCollection.properties.contents,l=Math.min(t.length,e);cap.state.open||cap.remove();for(var o=1;o<=l;o++)t[t.length-o].withdraw();t.splice(t.length-l,l),populateStorage("pillCount",Math.max(0,retrieveStorage("pillCount")-l)),bottle.prepare()},fill:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=(pillCollection.el,pillCollection.properties.contents),o=t.drop,n=0;n<e;n++){var a=new Pill;l.push(a),a.init(),o?a.drop(50*n):a.append()}populateStorage("pillCount",l.length),bottle.prepare()},refill:function(){buttonRefill.removeEvents();for(var e=pillCollection.el,t=pillCollection.fill;e.firstChild;)e.removeChild(e.firstChild);label.exportInformation(),t(prescription.quantity,{drop:!0}),cap.close()},init:function(){retrieveStorage("pillCount")||populateStorage("pillCount",0),pillCollection.fill(retrieveStorage("pillCount"))}};pillCollection.init();