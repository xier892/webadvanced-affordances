"use strict";var getRandomInt=function(e,t){return Math.floor(Math.random()*(Math.floor(t)-Math.ceil(e)))+Math.ceil(e)},storageAvailable=function(e){var t;try{t=window[e];var n="__storage_test__";return t.setItem(n,n),t.removeItem(n),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&t&&0!==t.length}},populateStorage=function(e,t){storageAvailable("localStorage")&&localStorage.setItem(e,t)},retrieveStorage=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return storageAvailable("localStorage")?localStorage.getItem(e):t},removeStorage=function(e){storageAvailable("localStorage")&&localStorage.removeItem(e)},setViewportHeight=function(){var e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px"))};window.addEventListener("contextmenu",function(e){e.preventDefault()}),setViewportHeight(),window.addEventListener("resize",function(){setViewportHeight()});var prescription={},defaultPrescription=JSON.stringify({quantity:15,dose:1});null===retrieveStorage("prescription")&&populateStorage("prescription",defaultPrescription);var updatePrescription=function(e){var t=e.quantity,n=e.dose;prescription.quantity=t,prescription.dose=n,populateStorage("prescription",JSON.stringify(e))};updatePrescription(JSON.parse(retrieveStorage("prescription",defaultPrescription)));var bottle={el:document.getElementById("bottle"),state:{capacity:"full"},setOpenState:function(){bottle.state.capacity=retrieveStorage("pillCount")>0?"full":"empty"},init:function(){bottle.setOpenState()}};bottle.init();var cap={properties:{width:0,height:0},state:{timer:0,clientX:0,clientY:0,deltaX:0,deltaY:0},setOpenState:function(e){cap.state.open="open"===e,populateStorage("capState",e)},depress:function(){cap.state.action="depressed",cap.el.className="cap pressed"},move:function(){cap.state.action="dragging",cap.el.className="cap dragging"},reset:function(){delete cap.state.action,cap.el.classList.remove("pressed","dragging"),cap.el.removeAttribute("style")},remove:function(){cap.state.action="dragged",cap.el.className="cap dragged",cap.setOpenState("open")},replace:function(){delete cap.state.action,cap.el.classList.remove("dragged"),cap.setOpenState("closed")},close:function(){setTimeout(cap.replace,50*retrieveStorage("pillCount",prescription.quantity)+250)},addEvents:function(){var e=cap.el,t=cap.properties,n=cap.state,a=cap.depress,o=cap.move,i=cap.reset,l=cap.remove,r=(cap.replace,t.width),c=t.height,p=n.timer,d=n.clientX,u=n.clientY,s=n.deltaX,m=n.deltaY;r=e.offsetWidth,c=e.offsetHeight,window.addEventListener("resize",function(){r=e.offsetWidth,c=e.offsetHeight}),e.addEventListener("touchstart",function(e){var t=e.touches;e.preventDefault(),d=t[0].clientX,u=t[0].clientY,p=setTimeout(a,250)},!1),e.addEventListener("touchmove",function(e){var t=e.target,a=e.touches;if(p&&clearTimeout(p),"depressed"===n.action||"dragging"===n.action){o(),s=a[0].clientX-d,m=a[0].clientY-u;var i=Math.max(-m/r,s/r);t.style.setProperty("--cap-rotate","".concat(i>0?Math.max(0,80*i):0,"deg")),t.style.setProperty("--cap-translate","".concat(m<0?Math.max(-40,m/4):0,"%"))}},!1),e.addEventListener("touchend",function(e){p&&clearTimeout(p),("dragging"===n.action&&s>=r/2.5||-m>=c/2.5)&&l(),i(),s=0,m=0},!1),e.addEventListener("touchcancel",function(e){p&&clearTimeout(p),i()},!1)},data:function(){var e=document.createElement("div");e.className="cap";for(var t=document.createDocumentFragment(),n=0;n<=12;n++){var a=document.createElement("div");a.className="cap-indent",t.appendChild(a)}return e.appendChild(t),e},init:function(){switch(cap.el=cap.data(),retrieveStorage("capState")){case"open":cap.remove()}document.getElementById("top").appendChild(cap.el),cap.addEvents()}};cap.init();var capunder={toggleButton:function(){switch(bottle.setOpenState(),bottle.state.capacity){case"empty":buttonTake.toggle();break;case"full":buttonRefill.toggle()}},data:function(){var e=document.createElement("section");return e.className="capunder",e},init:function(){capunder.el=capunder.data(),document.getElementById("top").appendChild(capunder.el)}};capunder.init();var buttonClose={addEvents:function(){buttonClose.el.addEventListener("touchend",function(e){cap.replace()},!1)},data:function(){var e=document.createElement("button");e.className="capunder-close",e.type="button",e.name="close";var t=document.createElement("img");return t.src="dist/assets/image/open-collapse-down.svg",t.alt="close",e.appendChild(t),e},init:function(){buttonClose.el=buttonClose.data(),buttonClose.addEvents(),capunder.el.appendChild(buttonClose.el)}};buttonClose.init();var buttonRefill={toggle:function(){var e=buttonRefill.el;document.body.contains(e)&&(e.remove(),buttonTake.init("toggle"))},addEvents:function(){buttonRefill.el.addEventListener("touchend",pillCollection.refill,!1)},removeEvents:function(){buttonRefill.el.removeEventListener("touchend",pillCollection.refill,!1)},data:function(){var e=document.createElement("button");e.className="capunder-refill",e.type="button",e.name="refill";var t=document.createDocumentFragment(),n=document.createElement("img");return n.src="dist/assets/image/material-arrow-drop-down.svg",n.alt="down arrow",t.appendChild(document.createTextNode("refill")),t.appendChild(document.createTextNode(" ")),t.appendChild(n),e.appendChild(t),e},init:function(){buttonRefill.el=buttonRefill.data(),buttonRefill.addEvents(),capunder.el.appendChild(buttonRefill.el)}},buttonTake={toggle:function(){var e=buttonTake.el;e.disabled=!0,setTimeout(function(){document.body.contains(e)?(e.remove(),buttonRefill.init()):e.removeAttribute("disabled")},300)},addEvents:function(){var e=buttonTake.el;e.removeAttribute("disabled"),e.addEventListener("touchend",function(e){pillCollection.take(prescription.dose)},!1)},data:function(){var e=document.createElement("button");e.className="capunder-take",e.type="button",e.name="take";var t=document.createDocumentFragment(),n=document.createElement("img");return n.src="dist/assets/image/material-arrow-drop-up.svg",n.alt="up arrow",t.appendChild(document.createTextNode("take")),t.appendChild(document.createTextNode(" ")),t.appendChild(n),e.appendChild(t),e},init:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";buttonTake.el=buttonTake.data(),"toggle"===e?(buttonTake.el.disabled=!0,setTimeout(buttonTake.addEvents,50*retrieveStorage("pillCount",prescription.quantity)+500)):buttonTake.addEvents(),capunder.el.appendChild(buttonTake.el)}};buttonTake.init();var pill={append:function(){pillCollection.el.appendChild(this.el)},withdraw:function(){this.el.style.transform="translateY(100vh) rotate3d(1, 0, ".concat(getRandomInt(0,.5),", 90deg)")},drop:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=function(){e.el.classList.add("easeOutBounce"),setTimeout(function(){e.el.classList.remove("easeOutBounce")},500),e.append()};t>0?setTimeout(n,t):n()},data:function(){var e=document.createElement("div");return e.className="pill",e.style.setProperty("--pill-rotation","".concat(getRandomInt(0,360),"deg")),e},init:function(){this.el=this.data()}},Pill=function(){return Object.create(pill)},pillCollection={el:document.getElementById("pill-collection"),properties:{contents:[]},take:function(e){pillCollection.el;for(var t=pillCollection.properties.contents,n=Math.min(t.length,e),a=1;a<=n;a++)t[t.length-a].withdraw();t.splice(t.length-n,n),populateStorage("pillCount",Math.max(0,retrieveStorage("pillCount")-n)),capunder.toggleButton()},fill:function(e){pillCollection.el;for(var t=pillCollection.properties.contents,n=e.quantity,a=e.drop,o=0;o<n;o++){var i=new Pill;t.push(i),i.init(),a?i.drop(50*o):i.append()}populateStorage("pillCount",t.length),capunder.toggleButton()},refill:function(){buttonRefill.removeEvents();for(var e=pillCollection.el,t=pillCollection.fill;e.firstChild;)e.removeChild(e.firstChild);t({quantity:prescription.quantity,drop:!0}),cap.close()},init:function(){null===retrieveStorage("pillCount")&&populateStorage("pillCount",prescription.quantity),pillCollection.fill({quantity:retrieveStorage("pillCount",prescription.quantity)})}};pillCollection.init();